# Maintainer: Florian LÃ©ger <florian6.leger@laposte.net>
pkgname=ashd
pkgver=0.9
pkgrel=1
pkgdesc="A Sane HTTP Daemon."
arch=(i686 x86_64)
url="http://www.dolda2000.com/~fredrik/ashd/"
license=('GPL')
source=(http://www.dolda2000.com/~fredrik/${pkgname}/${pkgname}-${pkgver}.tar.gz
        ashd
        ashd.conf)
depends=(gnutls file attr)
md5sums=('131d582645ed54481e7edbb3655b0a11'
         '5611d757b7d4695e721f5cc3600d39b1'
         '2ee675c226fa5396bb65fad1b0035e50')
backup=(etc/conf.d/ashd.conf etc/ashd/dirplex.rc etc/ashd/apache-compat)
install=ashd.install

build() {
  cd "$srcdir/$pkgname-$pkgver"

  ./configure --prefix=/usr || return 1
  make || return 1
  
  cd examples
  find . -type f -exec sed -i -e 's|#!/usr/bin/python| #!/usr/bin/env python2|' "{}" \;
}

package() {
  cd "$srcdir/$pkgname-$pkgver"

  make DESTDIR="$pkgdir/" install || return 1
  install -Dm644 etc/ashd/dirplex.rc "$pkgdir/etc/ashd/dirplex.rc"
  install -Dm644 etc/ashd/apache-compat "$pkgdir/etc/ashd/apache-compat"
  install -d "$pkgdir/etc/ashd/dirplex.d"
  install -m644 -t "$pkgdir/etc/ashd/dirplex.d" "etc/ashd/dirplex.d/"*.rc
  install -d "$pkgdir/usr/share/ashd/examples/"
  cp -r "examples/"* "$pkgdir/usr/share/ashd/examples/"
 
  cd "$srcdir"
  install -Dm755 ashd "$pkgdir/etc/rc.d/ashd"
  install -Dm644 ashd.conf "$pkgdir/etc/conf.d/ashd.conf"
}
